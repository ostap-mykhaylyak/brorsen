#!/bin/bash

if [ "$(whoami)" != "root" ]; then
	echo "You must be root to execute this script."
	exit 1
fi

user=$1
domain=$2
ip=$3

template="/usr/local/brorsen/template/nginx/vhost"
output="/home/${user}/conf/nginx/${domain}.conf"

if [[ -f $output ]]; then
	rm $output
fi

while IFS= read line; do
	echo "${line}" |
	sed "s|DOMAIN|${domain}|g" |
	sed "s|IP|${ip}|g" |
	sed "s|USER|${user}|g" >> $output
done < $template

/usr/sbin/nginx -t 2>/dev/null > /dev/null
if [[ $? == 0 ]]; then
	/etc/init.d/nginx reload
else
	echo "Please check NGINX config."
fi